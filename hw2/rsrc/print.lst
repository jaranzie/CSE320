000000		;
		; print a file transmitted over phone
		;
		
		.incld	defs.16
		;	Locations of useful monitor routines
		;
		getchr	=	512
		newln	=	1105
		space	=	1115
		rcall	=	1125
		call	=	1130
		ret4	=	1140
		ret3	=	1144
		ret2	=	1151
		ret1	=	1156
		ret0	=	1163
		ret	=	1167
		puts	=	1176
		putoct	=	1226
		div	=	1416
		mul	=	1533
		gchr0	=	1635
		gchr1	=	1643
		pchr0	=	1600
		pchr1	=	1606
		init0	=	1566
		init1	=	1573
		ischr0	=	1622
		ischr1	=	1626
		.	=	2300
002300		
	001271	print:	mov	buf, r1
	002363	
002302	000004		jsr	r5, call
	000400	
	001130	
002305	003120		pinit
002306	000004	pr.1:	jsr	r5, call
	000400	
	001130	
002311	002353		ack
002312	000004	pr.2:	jsr	r5, call
	000400	
	001130	
002315	001643		gchr1
002316	001570		cmp	12, r0
	000012	
002320	001044		beq	pr.2
	000007	
002322	000004		jsr	r5, call
	000400	
	001130	
002325	002566		putbuf
002326	001570		cmp	15, r0
	000015	
002330	001054		bneq	pr.2
	000017	
002332	000004	pr.3:	jsr	r5, call
	000400	
	001130	
002335	002634		size
002336	000200		tst	r0
002337	001044		bze	pr.1
	000032	
002341	000004		jsr	r5, call
	000400	
	001130	
002344	002611		getbuf
002345	000004		jsr	r5, call
	000400	
	001130	
002350	003046		pputc
002351	001040		b	pr.3
	000020	
002353	001270	ack:	mov	15, r0
	000015	
002355	000004		jsr	r5, call
	000400	
	001130	
002360	001606		pchr1
002361	001040		jmp	ret
	001173	
002363	002366	buf:	buf+3
002364	002366		buf+3
002365	000200		200
002366	000000		.blk	200
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
	000000	
002566		.incld	buf.16
		;
		; Circular buffer routines
		;
		;	buf:	startptr
		;		endptr
		;		size
		;		.blk	size
		;
		; address of buffer in r1
		
	000214	putbuf:	mov	r1, r4
002567	001241		mov	@r4+, r1
002570	001245		mov	@r4+, r5
002571	001242		mov	@r4+, r2
002572	001150		mov	r0, @r5+	; store data
002573	000250		mov	r5, r0
002574	000440		sub	r4, r0
002575	000520		cmp	r2, r0
002576	001014		bneq	pu.1
	000001	
002600	000245		mov	r4, r5
002601	000515	pu.1:	cmp	r1, r5
002602	001044		beq	ret
	001414	
002604	001474		sub	2, r4
	000002	
002606	001145		mov	r5, @r4+
002607	001040		jmp	ret
	001421	
002611		
	000214	getbuf:	mov	r1, r4
002612	001245		mov	@r4+, r5
002613	001241		mov	@r4+, r1
002614	001242		mov	@r4+, r2
002615	000515		cmp	r1, r5
002616	001044		beq	ret0
	001434	
002620	001250		mov	@r5+, r0
002621	000253		mov	r5, r3
002622	000443		sub	r4, r3
002623	000523		cmp	r2, r3
002624	001014		bneq	ge.1
	000001	
002626	000245		mov	r4, r5
002627	001474	ge.1:	sub	3, r4
	000003	
002631	001145		mov	r5, @r4+
002632	001040		jmp	ret0
	001450	
002634		
	000214	size:	mov	r1, r4
002635	001241		mov	@r4+, r1
002636	001240		mov	@r4+, r0
002637	001242		mov	@r4+, r2
002640	000410		sub	r1, r0
002641	001055		bge	ret0
	001457	
002643	000320		add	r2, r0
002644	001040		b	ret0
	001462	
002646		.incld	ptr.16
		;
		; Printer Driver Routines
		;
		
		NULL	=	0
		SPACE	=	101
		TAB	=	201
		BACK	=	3
		LF	=	21
		UP	=	11
		DOWN	=	5
		RETURN	=	41
		
		PTRSTAT	=	177760
		PTRDATA	=	177761
		
		RDY	=	1
		IEN	=	200
		ERR	=	2
		EOF	=	4
		EOL	=	10
		
	000000	ctab:	.word	NULL,	NULL,	NULL,	NULL
	000000	
	000000	
	000000	
002652	000000		.word	NULL,	NULL,	NULL,	NULL
	000000	
	000000	
	000000	
002656	000003		.word	BACK,	TAB,	LF,	NULL
	000201	
	000021	
	000000	
002662	000000		.word	NULL,	RETURN,	NULL,	NULL
	000041	
	000000	
	000000	
002666	000000		.word	NULL,	NULL,	NULL,	NULL
	000000	
	000000	
	000000	
002672	000000		.word	NULL,	NULL,	NULL,	NULL
	000000	
	000000	
	000000	
002676	000000		.word	NULL,	NULL,	NULL,	NULL
	000000	
	000000	
	000000	
002702	000000		.word	NULL,	NULL,	NULL,	NULL
	000000	
	000000	
	000000	
002706	000101		.word	SPACE,	600,	714,	300
	000600	
	000714	
	000300	
002712	000200		.word	200,	764,	004,	710
	000764	
	000004	
	000710	
002716	000740		.word	740,	770,	744,	404
	000770	
	000744	
	000404	
002722	000100		.word	100,	204,	002,	174
	000204	
	000002	
	000174	
002726	000370		.word	370,	374,	330,	334
	000374	
	000330	
	000334	
002732	000350		.word	350,	354,	320,	324
	000354	
	000320	
	000324	
002736	000344		.word	344,	340,	750,	734
	000340	
	000750	
	000734	
002742	000101		.word	SPACE,	774,	SPACE,	574
	000774	
	000101	
	000574	
002746	000104		.word	104,	074,	030,	034
	000074	
	000030	
	000034	
002752	000050		.word	050,	054,	020,	024
	000054	
	000020	
	000024	
002756	000044		.word	044,	040,	274,	230
	000040	
	000274	
	000230	
002762	000234		.word	234,	250,	254,	210
	000250	
	000254	
	000210	
002766	000224		.word	224,	244,	240,	130
	000244	
	000240	
	000130	
002772	000134		.word	134,	150,	164,	120
	000150	
	000164	
	000120	
002776	000124		.word	124,	144,	140,	SPACE
	000144	
	000140	
	000101	
003002	000101		.word	SPACE,	SPACE,	SPACE,	670
	000101	
	000101	
	000670	
003006	000101		.word	SPACE,	074,	030,	034
	000074	
	000030	
	000034	
003012	000050		.word	050,	054,	020,	024
	000054	
	000020	
	000024	
003016	000044		.word	044,	040,	274,	230
	000040	
	000274	
	000230	
003022	000234		.word	234,	250,	254,	210
	000250	
	000254	
	000210	
003026	000224		.word	224,	244,	240,	130
	000244	
	000240	
	000130	
003032	000134		.word	134,	150,	164,	120
	000150	
	000164	
	000120	
003036	000124		.word	124,	144,	140,	SPACE
	000144	
	000140	
	000101	
003042	000040		.word	040,	SPACE,	SPACE,	NULL
	000101	
	000101	
	000000	
003046		
	001670	pputc:	and	177, r0
	000177	
003050	001370		add	ctab, r0
	002646	
003052	000201		mov	r0, r1
003053	001210		mov	@r1, r0
003054	001570		cmp	NULL, r0
	000000	
003056	001044		beq	ret
	001670	
003060	001271		mov	400, r1
	000400	
003062	000601		and	r0, r1
003063	001272		mov	377, r2
	000377	
003065	000620		and	r2, r0
003066	001160		mov	r0, @sp+
003067	001202		mov	@shft, r2
	003133	
003071	000521		cmp	r2, r1
003072	001004		beq	pp.1
	000015	
003074	001270		mov	UP, r0
	000011	
003076	000211		tst	r1
003077	001014		bneq	pp.2
	000002	
003101	001270		mov	DOWN, r0
	000005	
003103	000004	pp.2:	jsr	r5, call
	000400	
	001130	
003106	003134		rpputc
003107	001101		mov	r1, @shft
	003133	
003111	001260	pp.1:	mov	@-sp, r0
003112	000004		jsr	r5, call
	000400	
	001130	
003115	003134		rpputc
003116	001040		jmp	ret
	001730	
003120		
	001270	pinit:	mov	RETURN | DOWN, r0
	000045	
003122	000004		jsr	r5, call
	000400	
	001130	
003125	003134		rpputc
003126	000700		clr	r0
003127	001100		mov	r0, @shft
	003133	
003131	001040		jmp	ret
	001743	
003133		
	000000	shft:	0
003134		
	001201	rpputc:	mov	@PTRSTAT,r1
	177760	
003136	001671		and	RDY,r1
	000001	
003140	001044		bze	rpputc
	000005	
003142	001100		mov	r0,@PTRDATA
	177761	
003144	001040		jmp	ret
	001756	
003146		

Symbol Table

BACK     =	000003	DOWN     =	000005	EOF      =	000004	
EOL      =	000010	ERR      =	000002	IEN      =	000200	
LF       =	000021	NULL     =	000000	PTRDATA  =	077761	
PTRSTAT  =	077760	RDY      =	000001	RETURN   =	000041	
SPACE    =	000101	TAB      =	000201	UP       =	000011	
ack      =	002353	buf      =	002363	call     =	001130	
ctab     =	002646	div      =	001416	gchr0    =	001635	
gchr1    =	001643	ge.1     =	002627	getbuf   =	002611	
getchr   =	000512	init0    =	001566	init1    =	001573	
ischr0   =	001622	ischr1   =	001626	mul      =	001533	
newln    =	001105	pchr0    =	001600	pchr1    =	001606	
pinit    =	003120	pp.1     =	003111	pp.2     =	003103	
pputc    =	003046	pr.1     =	002306	pr.2     =	002312	
pr.3     =	002332	print    =	002300	pu.1     =	002601	
putbuf   =	002566	putoct   =	001226	puts     =	001176	
rcall    =	001125	ret      =	001167	ret0     =	001163	
ret1     =	001156	ret2     =	001151	ret3     =	001144	
ret4     =	001140	rpputc   =	003134	shft     =	003133	
size     =	002634	space    =	001115	
